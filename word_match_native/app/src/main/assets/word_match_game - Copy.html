<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  
  <title>Word Match Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />


  <style>

        * {
          box-sizing: border-box;
        }

        .chunk-controls {
          width: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 15px; /* This creates spacing between label, input, and button */
          flex-wrap: wrap; /* Optional: makes it responsive */
        }

      .chunk-controls input {
        width: 70px;
        height: 50px;
        font-size: 28px; /* or whatever size you want */
        padding: 0 10px;
        border-radius: 8px;
        border: 2px solid #ccc;
      }
.chunk-controls label {
  font-size: 30px;
  font-weight: bold;
}

        body {
          font-family: sans-serif;
          margin: 0;
          padding: 0;
          position: relative;
          z-index: 2;
        }

        html, body {
          height: auto;
          overflow-y: auto;
          overflow-x: hidden;
          width: 100%;
          margin: 0;
          padding: 0;
          /* max-width: 100vw; */
        }

        .bg-image-layer {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-image: url("images/meetq.png");
          background-size: cover;
          background-position: center;
          z-index: 0;
        }

        .color-overlay-layer {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(255, 255, 255, 0.5);
          z-index: 1;
        }

        /* Align restart and input containers side-by-side */
        .restart-container, .chunk-input-container {
          flex: 1 1 200px;
          min-width: 180px;
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .chunk-input-container label {
          margin-right: 6px;
          font-weight: 600;
          white-space: nowrap;

        }

        /* Chunk input */
        #chunk-input {
          width: 50px;
          height: 40px;
          line-height: 38px;
          font-size: 30px;
          padding: 0 10px;
          border-radius: 8px;
          border: 2px solid #ccc;
          text-align: center;
        }

        /* Buttons base style */
        button {
          border-radius: 12px;
          padding: 18px 32px;
          font-weight: bold;
          font-size: 28px;
          cursor: pointer;
          border: 2px solid #577CA5;
          background-color: #577CA5;
          color: white;
          transition: background-color 0.3s ease;
          touch-action: manipulation;
          -webkit-tap-highlight-color: transparent;
        }

        button:hover {
          background-color: #3f5f82;
        }

        /* Restart and Next buttons override */
        #restart {
          background-color: #f0f0f0;
          color: black;
          border: 4px solid orange;
          border-radius: 16px;
          font-size: 25px;
          padding: 5px 10px;
          min-width: 100px;

        }

        #next-btn {
          background-color: #f0f0f0;
          color: black;
          border: 4px solid orange;
          border-radius: 16px;
          font-size: 25px;
          padding: 12px 28px;
          min-width: 100px;

        }

        #restart:hover, #next-btn:hover {
          background-color: #ffe5b4;
        }

        /* Next button disabled state */
        .next-btn-disabled {
          border: 10px solid #7D9E9D;
          color: gray;
          cursor: not-allowed;
          opacity: 1;
          background-color: #f0f0f0;
        }

        .main-container {
          position: relative;
          z-index: 2;
          display: flex;
          flex-direction: row;
          flex-wrap: nowrap;
          justify-content: center;
          align-items: flex-start;
          gap: 28px;
          max-width: 980px;
          width: 100%;
          margin: 0 auto;
          padding: 24px;
          /* TEMP for debug: */
          background: rgba(0,128,255,0.08);
        }

        .column {
          flex: 1 1 0%;
          min-width: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          width: 50%;
        }

        .card {
          position: relative;
          padding: 10px 6px;
          background: #eee;
          border: 8px solid #577CA5;
          border-radius: 25px;
          margin: 8px 0;
          cursor: pointer;
          transition: background 0.2s;
          user-select: none;
          text-align: center;
          min-height: 40px;
          min-width: 0;
          width: 100%;
          max-width: none;
          font-weight: bold;
          line-height: 1.2;
          font-size: 28px;
          overflow: hidden;
          white-space: normal;
          text-overflow: clip;
          display: flex;
          align-items: center;
          justify-content: center;
          box-sizing: border-box;
          word-break: break-word;
        }

        @media (max-width: 600px) {
          .main-container {
            flex-direction: row;
            flex-wrap: nowrap;
            gap: 4px;
            padding: 2px;
            max-width: 99vw;
          }
          .column {
            width: 100%;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            width: 50%;
          }
          .card {
            width: 100%;
            max-width: none;
            font-size: 24px;
            padding: 5px 2px;
          }
          .game-intro-sticky {
            padding: 6px 8px;
            border-width: 3px;
            max-width: 99vw;
          }
          button {
            font-size: 18px;
            padding: 7px 12px;
            border-width: 6px;
          }
        }

        .card.selected {
          background-color: #cce5ff;
        }

        .card.matched {
          background-color: lightgreen;
          pointer-events: none;
        }

        .controls {
          text-align: center;
          margin-top: 20px;
        }

        /* Game intro sticky section */
.game-intro-sticky {
  border: 3px solid #577CA5;
  border-radius: 10px;
  padding: 4px 8px;
  width: 100%;
  max-width: 720px;
  margin: 8px auto 8px;
  box-sizing: border-box;
  text-align: center;
}

.game-intro h2 {
  font-size: clamp(20px, 4vw, 32px);
  color: #2e7cd9;
  margin: 0;
  line-height: 1.1;
  padding: 2px 0;
  text-shadow:
    -1px -1px 0 orange,
    1px -1px 0 orange,
    -1px  1px 0 orange,
    1px  1px 0 orange;
}


        .button-section {
          display: flex;
          justify-content: center;
          align-items: flex-start;
          min-height: 60vh;
          padding-top: 20px;
          z-index: 2;
          position: relative;
          overflow: visible;
        }

        /* Custom alert */
        .custom-alert {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          z-index: 9999;
        }

        .custom-alert-box {
          position: absolute;
          top: 40%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: white;
          padding: 30px 40px;
          border-radius: 12px;
          text-align: center;
          box-shadow: 0 0 15px rgba(0,0,0,0.3);
          width: 80%;
          max-width: 500px;
        }

        .custom-alert-box button {
          margin: 5px 10px;
          padding: 6px 16px;
          border: none;
          background-color: #007bff;
          color: white;
          border-radius: 5px;
          cursor: pointer;
        }

        .custom-alert-box button:hover {
          background-color: #0056b3;
        }

        #custom-confirm-message {
          font-size: 20px;
          color: #333;
          margin-bottom: 20px;
        }

        .confirm-buttons {
          display: flex;
          justify-content: center;
          gap: 20px;
          margin-top: 15px;
        }

        .confirm-buttons button {
          min-width: 100px;
          padding: 10px 20px;
          font-size: 16px;
          font-weight: bold;
          border-radius: 6px;
        }


    @media (max-width: 480px) {
  .main-container {
    flex-direction: row;
    flex-wrap: nowrap;
    gap: 2px;
    padding: 1px;
    max-width: 99vw;
  }
  .column {
    width: 100%;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    width: 50%;
  }
  .card {
    max-width: 90vw;
    font-size: clamp(10px, 2.5vw, 14px);
    padding: 3px 2px;
    border-width: 2px;
    min-height: 18px;
  }
  .game-intro-sticky {
    padding: 2px 3px;
    border-width: 1.5px;
    border-radius: 6px;
    margin: 4px auto 4px;
    min-height: unset;
    height: auto;
  }
  .game-intro h2 {
    font-size: 10px;
    line-height: 1.02;
    padding: 0;
  }
  .chunk-controls {
    gap: 4px;
    padding: 0;
  }
  .chunk-controls label {
    font-size: 10px;
    margin-right: 2px;
  }
  .chunk-controls input {
    height: 16px;
    font-size: 10px;
    padding: 0 4px;
    border-radius: 4px;
  }
}
    @keyframes blink {
  0% { box-shadow: 0 0 10px 4px orange; }
  50% { box-shadow: 0 0 20px 8px yellow; }
  100% { box-shadow: 0 0 10px 4px orange; }
}

.blinking {
  animation: blink 1s infinite;
}


  </style>


</head>
<body>
<div class="bg-image-layer"></div>
<div class="color-overlay-layer"></div>

<!-- Settings modal (hidden by default) -->
<div id="settings-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.35); z-index:2000; justify-content:center; align-items:center;">
  <div style="background:white; border-radius:16px; padding:32px 24px; min-width:280px; box-shadow:0 4px 24px rgba(0,0,0,0.18); position:relative; text-align:center;">
    <button id="close-settings" style="position:absolute; top:10px; right:14px; background:none; border:none; font-size:28px; cursor:pointer; color:#888;">&times;</button>
    <h2 style="margin-bottom:24px; color:#577CA5;">Settings</h2>
    <label style="font-size:20px; font-weight:bold;">
      <input type="checkbox" id="lang-toggle" style="transform:scale(1.5); margin-right:8px; vertical-align:middle;">
      <span id="lang-label">English</span>
    </label>
  </div>
</div>

<div class="game-intro-sticky">
  <div class="game-intro">
    <h2 style="font-size: 25px; color: #2e7cd9;text-align: center;
        text-shadow:
        -1px -1px 0 orange,
        1px -1px 0 orange,
        -1px  1px 0 orange,
        1px  1px 0 orange;
        margin-bottom: 15px;"> Word Match:<br> English and Armenian </h2>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; gap: 16px; margin-top: 10px;">
    <button id="restart" style="background-color: #f0f0f0; color: black; border: 4px solid orange; border-radius: 16px; font-size: 25px; padding: 12px 28px; min-width: 100px;">🔄 Restart</button>
    <div id="settings-icon" style="cursor:pointer; font-size:28px; color:#577CA5; background:rgba(255,255,255,0.7); border-radius:50%; padding:4px; display:flex; align-items:center; justify-content:center;">
      <span title="Settings">&#9881;</span>
    </div>
  </div>
</div>
<div class="button-section">
  <div class="main-container">
    <div class="column" id="english-column"></div>
    <div class="column" id="armenian-column"></div>
  </div>
</div>

<div class="main-container">

  <button id="next-btn" class="next-btn-disabled">Next ➡️</button>
</div>

<h2>MEETQONLINE SCHOOL</h2>

<audio id="match-sound" src="games/sounds/short-success.mp3"></audio>
<audio id="win-sound" src="games/sounds/success.mp3"></audio>
<div id="custom-alert" class="custom-alert">
  <div class="custom-alert-box">
    <p id="custom-alert-message"></p>
    <button onclick="closeCustomAlert()">OK</button>
  </div>
</div>

<div id="custom-confirm" class="custom-alert">
  <div class="custom-alert-box">
    <p id="custom-confirm-message"></p>
    <div class="confirm-buttons">
      <button onclick="confirmYes()">Yes</button>
      <button onclick="confirmNo()">No</button>
    </div>
  </div>
</div>



<script>
  let wordPairs = [];
  let chunkSize = 7;
  let currentPage = 0;
  let engCol, armCol, nextBtn;
  let confirmCallback = null;
  let nextBtnEnabled = false;
  let selected = [];
  let matchCount = 0;
  let pagePairs = [];

document.addEventListener("DOMContentLoaded", () => {
  engCol = document.getElementById("english-column");
  armCol = document.getElementById("armenian-column");
  nextBtn = document.getElementById("next-btn");

  // Load chunk size from localStorage, default to 7
  chunkSize = parseInt(localStorage.getItem('chunkSize')) || 7;

  // Load game level from localStorage, default to 'easy'
  const gameLevel = localStorage.getItem('gameLevel') || 'easy';
  const wordPairsFile = gameLevel === 'difficult' ? 'word_pairs.json' : 'word_pairs1.json';

  // Load word pairs
  fetch(wordPairsFile)
    .then(response => {
      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
      return response.json();
    })
    .then(data => {
      wordPairs = shuffleArray(data);
      startGame(wordPairs);
    })
    .catch(err => {
      console.error("Failed to load word_pairs.json:", err);
      startGame(wordPairs); // fallback
    });

  // NEXT button
  nextBtn.addEventListener("click", () => {
    if (!nextBtnEnabled) {
      showCustomAlert("Match the pairs before proceeding");
      return;
    }
    if ((currentPage + 1) * chunkSize < wordPairs.length) {
    nextBtn.classList.remove("blinking");
      currentPage++;
      renderPage(currentPage);
    }
  });

  // Settings icon click navigates to settings.html
  const settingsIcon = document.getElementById('settings-icon');
  settingsIcon.addEventListener('click', () => {
    window.location.href = 'settings.html';
  });

  // Restart button
  const restartBtn = document.getElementById('restart');
  restartBtn.addEventListener('click', () => {
    // Reload chunk size from localStorage
    chunkSize = parseInt(localStorage.getItem('chunkSize')) || 7;
    currentPage = 0;
    
    // Re-shuffle word list
    wordPairs = shuffleArray(wordPairs);
    
    // Restart game with new chunk size
    startGame(wordPairs);
  });

  // Language switch logic (inside modal)
  const toggle = document.getElementById('lang-toggle');
  const label = document.getElementById('lang-label');
  toggle.addEventListener('change', function () {
    label.textContent = this.checked ? 'Հայերեն' : 'English';
  });
});


function renderAllWords(pairs) {
  if (!engCol || !armCol) return;

  engCol.innerHTML = "";
  armCol.innerHTML = "";

  const enItems = shuffleArray(pairs.map(pair => ({
    word: pair.en,
    pairId: pair.en,
    lang: 'en'
  })));

  const hyItems = shuffleArray(pairs.map(pair => ({
    word: pair.hy,
    pairId: pair.en,
    lang: 'hy'
  })));

  enItems.forEach(item => {
    const div = document.createElement("div");
    div.className = "card";
    div.textContent = item.word;
    engCol.appendChild(div);
  });

  hyItems.forEach(item => {
    const div = document.createElement("div");
    div.className = "card";
    div.textContent = item.word;
    armCol.appendChild(div);
  });
}



  function shuffleArray(array) {
    return array.sort(() => Math.random() - 0.5);
  }

  function startGame(pairs) {
    wordPairs = pairs;
    renderPage(currentPage);
  }

  function renderPage(page) {
    if (!engCol || !armCol || !nextBtn) return;

    engCol.innerHTML = "";
    armCol.innerHTML = "";
    nextBtnEnabled = false;
    nextBtn.classList.add("next-btn-disabled");

    const start = page * chunkSize;
    const end = start + chunkSize;
    pagePairs = wordPairs.slice(start, end);

    if (pagePairs.length === 0) return;

    matchCount = 0;
    selected = [];

    const enItems = shuffleArray(pagePairs.map(pair => ({
      word: pair.en,
      pairId: pair.en,
      lang: 'en'
    })));

    const hyItems = shuffleArray(pagePairs.map(pair => ({
      word: pair.hy,
      pairId: pair.en,
      lang: 'hy'
    })));

    // Helper to get language from localStorage (default to 'en')
    function getCurrentLanguage() {
      if (typeof localStorage !== 'undefined' && localStorage !== null) {
        return localStorage.getItem('language') === 'hy' ? 'hy' : 'en';
      }
      return 'en'; // fallback to English if localStorage is not available
    }

    function createCard(item, container) {
      const div = document.createElement("div");
      div.textContent = item.word;
      div.className = "card";
      div.dataset.pairId = item.pairId;
      div.dataset.lang = item.lang;
      container.appendChild(div);

      // 👇 Add style adjustments for text wrapping or shrinking
      adjustCardStyle(div);

      div.addEventListener("click", () => {
        if (
          selected.length < 2 &&
          !div.classList.contains("matched") &&
          !div.classList.contains("selected")
        ) {
          div.classList.add("selected");
          selected.push(div);

          if (selected.length === 2) {
            const [first, second] = selected;

            if (
              first.dataset.pairId === second.dataset.pairId &&
              first !== second &&
              first.dataset.lang !== second.dataset.lang
            ) {
              first.classList.add("matched");
              second.classList.add("matched");

              // Debug: log localStorage.language and lang
              if (typeof localStorage !== 'undefined' && localStorage !== null) {
                console.log('localStorage.language:', localStorage.getItem('language'));
              } else {
                console.log('localStorage is not available');
              }
              const lang = getCurrentLanguage();
              console.log('lang for audio:', lang);
              let audioPath;
              if (lang === 'en') {
                const word = first.dataset.pairId.trim().toLowerCase();
                audioPath = `games/sounds/audio_eng2/${word}.mp3`;
              } else {
                const pair = pagePairs.find(p => p.en.trim().toLowerCase() === first.dataset.pairId.trim().toLowerCase());
                if (pair) {
                  const hyWord = pair.hy.trim();
                  audioPath = `games/sounds/audio_arm2/${encodeURIComponent(hyWord)}.wav`;
                }
              }
              if (audioPath) {
                console.log('Trying to play:', audioPath);
                const audio = new Audio(audioPath);
                audio.play().catch(e => {
                  console.warn('Audio file not found or failed to play:', audioPath, e);
                });
              }

              document.getElementById("match-sound").play();
              selected = [];
              matchCount++;

              if (matchCount === pagePairs.length) {
                nextBtnEnabled = true;
                nextBtn.classList.remove("next-btn-disabled");
                nextBtn.classList.add("blinking");
                setTimeout(() => {
                  document.getElementById("win-sound").play();
                }, 300);
              }
            } else {
              setTimeout(() => {
                first.classList.remove("selected");
                second.classList.remove("selected");
                selected = [];
              }, 1000);
            }
          }
        }
      });
    }

    function adjustCardStyle(card) {
      card.style.fontSize = "15px";
      card.style.whiteSpace = "normal";
      card.style.wordBreak = "break-word";
      card.style.overflow = "";
      card.style.textOverflow = "";
    }

    enItems.forEach(item => createCard(item, engCol));
    hyItems.forEach(item => createCard(item, armCol));
  }



  function showCustomAlert(message) {
    document.getElementById("custom-alert-message").textContent = message;
    document.getElementById("custom-alert").style.display = "block";
  }

  function closeCustomAlert() {
    document.getElementById("custom-alert").style.display = "none";
  }

  function showCustomConfirm(message, callback) {
    document.getElementById("custom-confirm-message").textContent = message;
    document.getElementById("custom-confirm").style.display = "block";
    confirmCallback = callback;
  }

  function confirmYes() {
    document.getElementById("custom-confirm").style.display = "none";
    if (confirmCallback) confirmCallback(true);
  }

  function confirmNo() {
    document.getElementById("custom-confirm").style.display = "none";
    if (confirmCallback) confirmCallback(false);
  }
</script>



</body>
</html>
